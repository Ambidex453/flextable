---
title: "Introdution to `flextable` objects"
author: "David Gohel"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{flextable_introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

`flextable` makes possible to create beautiful reporting table from `data.frame`. 

```{r warning=FALSE, message=FALSE, echo=FALSE}
library(flextable)
library(oxbase)
library(dplyr)
iris %>% 
  group_by(Species) %>% 
  do( head(., n = 3) ) %>% 
  flextable(col_keys = c("Species", 
                       "break1", "Sepal.Length", "Sepal.Width", 
                        "break2", "Petal.Length", "Petal.Width") ) %>% 
  set_header_labels(
    Sepal.Length = "Length", Sepal.Width = "Width",
    Petal.Length = "Length", Petal.Width = "Width",
    Species = "Species"
    ) %>% 
  add_header(top = TRUE, 
    Sepal.Length = "Sepal", Sepal.Width = "Sepal",
    Petal.Length = "Petal", Petal.Width = "Petal",
    Species = "Species"
    ) %>% 
  style(pr_t = fp_bold(font.size = 12), part = "header") %>% 
  style(pr_t = fp_text(font.size = 12), part = "body") %>% 
  style(pr_t = fp_bi(font.size = 12), j = ~ Species ) %>% 
  padding(padding = 2, part = "all") %>% 
  border( border.top = fp_border(), part = "all" ) %>% 
  bg(i = ~ seq_along(Petal.Length) %% 2 == 0, bg = "#EFEFEF") %>% 
  border( j = ~ break1 + break2, 
          border.top = b_null(), border.bottom = b_null(), part = "all" ) %>% 
  border( i = 1, border.left = b_null(), border.right = b_null(), 
          border.top = b_null(), part = "header" ) %>% 
  bg(j = ~ break1 + break2, bg = "transparent", part = "all") %>% 
  autofit() %>% 
  tabwid()
```


```{r warning=FALSE, message=FALSE}
library(flextable)
library(oxbase)
library(dplyr)

myft <- flextable(head(mtcars), 
                  col_keys = c("am", "carb", "gear", "mpg", "drat" )) %>% 
  bold(part = "header")
tabwid(myft)
```


Function `style` is changing formatting properties of table elements. 

```{r warning=FALSE, message=FALSE}
myft <- myft %>% 
  style(pr_c = c_b_b(), pr_p = fp_right(padding=2), part = "all" )
tabwid(myft)
```

Conditional formatting can be made by using the selector arguments.

```{r warning=FALSE, message=FALSE}
myft <- myft %>% 
  style(i = ~ drat > 3.5, j = ~ drat, pr_t = fp_italic(color="#44A530") )
tabwid(myft)
```

Merge cells

```{r warning=FALSE, message=FALSE}

myft <- myft %>%
  merge_v(j = c("carb", "am") )
tabwid(myft)
```


Format content

```{r warning=FALSE, message=FALSE}
myft <- myft %>%
  display(
    am = fpar(formatC(am, format = "f", digits = 0 )),
    gear = fpar("# ", ftext( gear, prop = fp_bold()) ),
    mpg = fpar(mpg, " (", ftext( carb, prop = fp_italic()), ")." ), 
    drat = fpar(minibar( value = drat, max = 5, barcol = "#C90000", width = 1, height = .15) )
  )
tabwid(myft)
```

Parameter `col_keys` define the variables to display and their order. 

```{r}
library(dplyr)
iris %>% 
  group_by(Species) %>% 
  do( head(., n = 3) ) %>% 
  flextable(col_keys = c("Species", "Sepal.Length", "Petal.Length") ) %>%
  tabwid()

```

If parameter `col_keys` has variables that are not existing in the dataset, they will be considered as blank columns and can be used as separators.

```{r}
iris %>% group_by(Species) %>% do( head(., n = 3) ) %>%
  flextable(col_keys = c("Species", "col_1", "Sepal.Length", "Petal.Length") ) %>%
  theme_vanilla() %>% autofit() %>% 
  border(j=2, border = fp_border(width=0), part = "all") %>% 
  tabwid()

```

