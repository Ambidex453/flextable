---
title: "flextable objects"
author: "David Gohel"
output: 
  rmarkdown::html_vignette:
    toc: true 
    toc_depth: 3
vignette: >
  %\VignetteIndexEntry{flextable objects}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r echo = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  collapse = TRUE,
  comment = "#>"
)
```

`flextable` makes possible to create beautiful reporting table from `data.frame`. 

```{r warning=FALSE, echo=FALSE}
library(flextable)
library(officer)
library(dplyr)

typology <- data.frame(
  col_keys = c( "Sepal.Length", "Sepal.Width", "Petal.Length",
                "Petal.Width", "Species" ),
  what = c("Sepal", "Sepal", "Petal", "Petal", "Species"),
  measure = c("Length", "Width", "Length", "Width", "Species"),
  stringsAsFactors = FALSE )


iris %>% 
  group_by(Species) %>% 
  do( head(., n = 3) ) %>% 
  flextable(col_keys = c("Species", 
                       "break1", "Sepal.Length", "Sepal.Width", 
                        "break2", "Petal.Length", "Petal.Width") ) %>% 
  set_header_df(mapping = typology, key = "col_keys" ) %>% 
  theme_zebra(even_header = "transparent", odd_header = "transparent") %>% 
  theme_vanilla() %>% 
  empty_blanks() %>% 
  autofit() %>% 
  tabwid()
```

---

Let's have a step by step demo. First create a flextable. Change header font in bold. Function `tabwid` will wrap it in an *htmlwidget*.

```{r warning=FALSE, message=FALSE}
library(flextable)
library(officer)
library(dplyr)

myft <- flextable(head(mtcars), 
                  col_keys = c("am", "carb", "gear", "mpg", "drat" )) %>% 
  bold(part = "header")
tabwid(myft)
```


Function `style` is changing formatting properties of table elements. 

```{r warning=FALSE, message=FALSE}
myft <- myft %>% 
  style(pr_c = fp_cell( border = fp_border( width = 0), border.top = fp_border()), 
        pr_p = fp_par(text.align = "center", padding=2), part = "all" )
tabwid(myft)
```

Conditional formatting can be made by using the selector arguments.

```{r warning=FALSE, message=FALSE}
myft <- myft %>% 
  style(i = ~ drat > 3.5, j = ~ drat, pr_t = fp_text(italic = TRUE, color="#44A530") )
tabwid(myft)
```

Identical consecutive cells can be merged:

```{r warning=FALSE, message=FALSE}

myft <- myft %>%
  merge_v(j = c("carb", "am") )
tabwid(myft)
```


Cell content can be defined and customized with function `display`:

```{r warning=FALSE, message=FALSE}
myft <- myft %>%
  display(
    am = fpar(formatC(am, format = "f", digits = 0 )),
    gear = fpar("# ", ftext( gear, prop = fp_text(bold = TRUE)) ),
    mpg = fpar(mpg, " (", ftext( carb, prop = fp_text(italic = TRUE)), ")." ), 
    drat = fpar(minibar( value = drat, max = 5, barcol = "#C90000", width = 1, height = .15) )
  ) %>% autofit()
tabwid(myft)
```


