---
title: "Headers"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Define headers}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r echo = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  collapse = TRUE,
  comment = "#>"
)
```

```{r warning=FALSE}
library(flextable)
library(oxbase)
library(magrittr)
```

## col_keys

Parameter `col_keys` define the variables to display and their order. 

```{r}
library(dplyr)
iris %>% 
  group_by(Species) %>% 
  do( head(., n = 3) ) %>% 
  flextable(col_keys = c("Species", "Sepal.Length", "Petal.Length") ) %>%
  tabwid()

```

If parameter `col_keys` has variables that are not existing in the dataset, they will be considered as blank columns and can be used as separators.

```{r}
iris %>% group_by(Species) %>% do( head(., n = 3) ) %>%
  flextable(col_keys = c("Species", "col_1", "Sepal.Length", "Petal.Length") ) %>%
  theme_vanilla() %>% autofit() %>% 
  border(j=2, border = fp_border(width=0), part = "all") %>% 
  tabwid()

```

**`col_keys` default values are the names of the data.frame used to fill the flextable.**

## Change labels

Use `set_header_labels` to replace labels of the bottom row of header. 

```{r warning=FALSE, message=FALSE}
ft <- flextable( head( iris ) ) %>% 
  set_header_labels(Sepal.Length = "Sepal", 
    Sepal.Width = "Sepal", Petal.Length = "Petal",
    Petal.Width = "Petal", Species = "Species" )
  
ft %>% theme_vanilla() %>% autofit() %>% tabwid()
```

## add a row of labels

Use `add_header` to add an header row. 

```{r warning=FALSE, message=FALSE}
ft <- ft %>% 
  add_header(Sepal.Length = "length",
    Sepal.Width = "width", Petal.Length = "length",
    Petal.Width = "width", Species = "Species", top = FALSE ) 
ft %>% theme_vanilla() %>% autofit() %>% tabwid()
ft <- ft %>% 
  add_header(Sepal.Length = "Inches",
    Sepal.Width = "Inches", Petal.Length = "Inches",
    Petal.Width = "Inches", Species = "Species", top = TRUE )
ft %>% theme_vanilla() %>% autofit() %>% tabwid()
```


## Define headers with a reference table

Use `set_header_df` with a data.frame as parameter. Columns of the dataset will be transposed and joined using a key column. 

### Input dataset 

Variable `col_keys` define key values to match with flextable column keys (defined by argument `col_keys` of `flextable` function).

This key column will not be displayed. Other variables will added as rows. Note that variables names are not displayed.

```{r warning=FALSE, message=FALSE}
typology <- data.frame(
  col_keys = c( "Sepal.Length", "Sepal.Width", "Petal.Length",
                "Petal.Width", "Species" ),
  type = c("double", "double", "double", "double", "factor"),
  what = c("Sepal", "Sepal", "Petal", "Petal", "Species"),
  measure = c("Length", "Width", "Length", "Width", "Species"),
  stringsAsFactors = FALSE )
typology %>% flextable() %>% theme_vanilla() %>% autofit() %>% tabwid()
```

### Add the dataset as header rows

Then use `set_header_df` with parameter `key` that specifies name of the column used 
to permform the join. Order of columns matters, first column will be first row, second one will be the second row, etc.

```{r warning=FALSE, message=FALSE}
flextable( head( iris ) ) %>% 
  set_header_df( mapping = typology, key = "col_keys" ) %>% 
  theme_vanilla() %>% autofit() %>% tabwid()
```

